---
title: "TMA4250-Project-3"
author: "Ole Riddervold, Ole Kristian Skogly"
date: "2023-04-13"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source("functions.R")

library(ggplot2)
library(patchwork)
library(tidyverse)
library(rgdal)
library(spdep)
library(latex2exp)
library(LaplacesDemon)
library(pracma)
library(MASS)
library(reshape2)
```

# Geography data

The data is loaded into the R environment as **nigeriaAdm1** and **nigeriaAdm2** respectively.
```{r}
load("data/Admin1Geography.RData")
load("data/Admin2Geography.RData")
```


# Problem 1

## a)

## b)

## c)

## d)


# Problem 2

## a)

```{r}
direct_estimates <- read.table(
  "data/DirectEstimates.txt",
  skip=1,
  col.names=c("area_name", "obs", "stdev")
) %>%
  mutate(obs=invlogit(obs))


plotAreaCol(
  "figures/2a.jpg",
  width=25,
  height=20,
  estVal=direct_estimates$obs,
  geoMap=nigeriaAdm1,
  leg=TeX("$\\hat{p}$")
)
```
It is clear that there is a considerable amount of dependence between the various regions, and therefore borrowing strength in space to reduce uncertainty is indeed reasonable.


## b)
### Calculating the parameters for posterior distribution
```{r}
# Treating data:
y <- direct_estimates$obs
D <- diag(direct_estimates$stdev)
n <- length(y)
sigma_squared <- 100^2

# Posterior distribution parameters:
simple.Sigma <- solve( solve(D) + (1/sigma_squared)*identity(n) )
simple.mu    <- simple.Sigma %*% solve(D) %*% y
```

### Empirical estimation of median and standard deviation 
We wish to do an empirical estimation of the median and standard deviation of $P_a | Y_a=y_a, \: a\in \{1, \cdots, n\}$
```{r}
simple.samples <- sigmoid(mvrnorm(simple.mu, simple.Sigma, n=100))

simple.sum <- simple.samples %>%
  melt(varnames=c("sample", "a")) %>%
  group_by(a) %>%
  summarise(median.est=median(value), std.est=std(value))
```
Plotting:
```{r}
plotAreaCol(
  "figures/2b_median.jpg",
  width=25,
  height=20,
  estVal=simple.sum$median.est,
  geoMap=nigeriaAdm1,
  leg="median est."
)

plotAreaCol(
  "figures/2b_std.jpg",
  width=25,
  height=20,
  estVal=simple.sum$std.est,
  geoMap=nigeriaAdm1,
  leg=TeX("$\\hat{\\sigma^2}$")
)
```


## c)
```{r}
tau <- 1.0

# Posterior distribution parameters:
besag.Sigma <- solv
```


## d)

## e)

## f)
